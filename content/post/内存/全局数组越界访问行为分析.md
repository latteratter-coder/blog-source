+++
date = '2025-09-12'
title = 'å…¨å±€æ•°ç»„è¶Šç•Œè®¿é—®è¡Œä¸ºåˆ†æ'
tags = [
    "å†…å­˜",
]
categories = [
    "å†…å­˜",
]
+++

# å…¨å±€æ•°ç»„è¶Šç•Œè®¿é—®è¡Œä¸ºåˆ†ææŠ¥å‘Š

## ğŸ“‹ ç›®å½•
- [é—®é¢˜èƒŒæ™¯](#é—®é¢˜èƒŒæ™¯)
- [æµ‹è¯•ç¯å¢ƒ](#æµ‹è¯•ç¯å¢ƒ)
- [æµ‹è¯•è®¾è®¡](#æµ‹è¯•è®¾è®¡)
- [å®éªŒç»“æœ](#å®éªŒç»“æœ)
- [æ·±å…¥åˆ†æ](#æ·±å…¥åˆ†æ)
- [å®‰å…¨æ€§è®¨è®º](#å®‰å…¨æ€§è®¨è®º)
- [æœ€ä½³å®è·µå»ºè®®](#æœ€ä½³å®è·µå»ºè®®)
- [é™„å½•](#é™„å½•)

---

## é—®é¢˜èƒŒæ™¯

åœ¨Cè¯­è¨€ç¼–ç¨‹ä¸­ï¼Œæ•°ç»„è¶Šç•Œè®¿é—®æ˜¯ä¸€ä¸ªå¸¸è§ä¸”å±é™©çš„é—®é¢˜ã€‚æœ¬æŠ¥å‘Šä¸“é—¨ç ”ç©¶ä»¥ä¸‹åœºæ™¯ï¼š

> **ç ”ç©¶é—®é¢˜**ï¼šåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­å®šä¹‰ä¸¤ä¸ªå…¨å±€å­—ç¬¦æ•°ç»„Aã€Bï¼ˆå¤§å°å‡ä¸º10ï¼‰ï¼Œå½“æ•°ç»„Aç›´æ¥è®¿é—®ç¬¬12ä½ï¼ˆA[12]ï¼‰æ—¶ï¼Œç¨‹åºæ˜¯å¦ä¼šå´©æºƒï¼Ÿèƒ½å¦æ­£å¸¸è®¿é—®ï¼Ÿ

è¿™ä¸ªé—®é¢˜æ¶‰åŠåˆ°ï¼š
- å…¨å±€å˜é‡çš„å†…å­˜å¸ƒå±€
- æ“ä½œç³»ç»Ÿçš„å†…å­˜ä¿æŠ¤æœºåˆ¶
- ç¼–è¯‘å™¨çš„å†…å­˜å¯¹é½ç­–ç•¥
- æœªå®šä¹‰è¡Œä¸ºçš„å®é™…è¡¨ç°

---

## æµ‹è¯•ç¯å¢ƒ

| é¡¹ç›® | è¯¦æƒ… |
|------|------|
| **æ“ä½œç³»ç»Ÿ** | Linux 5.15.0-138-generic (Ubuntu) |
| **æ¶æ„** | x86_64 |
| **ç¼–è¯‘å™¨** | GCC (GNU Compiler Collection) |
| **ç¼–è¯‘é€‰é¡¹** | `-Wall -Wextra -g -O0` |
| **æµ‹è¯•å·¥å…·** | AddressSanitizer, Valgrind, objdump |

---

## æµ‹è¯•è®¾è®¡

### æµ‹è¯•ç¨‹åºç»“æ„

```c
// å…¨å±€æ•°ç»„å®šä¹‰
char A[10];  // æ•°ç»„Aï¼Œå¤§å°10å­—èŠ‚
char B[10];  // æ•°ç»„Bï¼Œå¤§å°10å­—èŠ‚

// æµ‹è¯•å†…å®¹
1. å†…å­˜å¸ƒå±€åˆ†æ
2. æ­£å¸¸èŒƒå›´è®¿é—®æµ‹è¯•
3. è¶Šç•Œè¯»å–æµ‹è¯• (A[10] ~ A[15])
4. è¶Šç•Œå†™å…¥æµ‹è¯• (A[10] ~ A[12])
5. å¤§èŒƒå›´è¶Šç•Œæµ‹è¯• (A[10] ~ A[100])
6. æ®µé”™è¯¯æ•è·æœºåˆ¶
```

### æµ‹è¯•æ–¹æ³•

1. **åŸºç¡€æµ‹è¯•**ï¼šä½¿ç”¨æ ‡å‡†ç¼–è¯‘é€‰é¡¹è¿›è¡Œæµ‹è¯•
2. **å†…å­˜æ£€æµ‹**ï¼šä½¿ç”¨AddressSanitizeræ£€æµ‹å†…å­˜é”™è¯¯
3. **ç¬¦å·åˆ†æ**ï¼šä½¿ç”¨objdumpåˆ†æå†…å­˜å¸ƒå±€
4. **å¼‚å¸¸å¤„ç†**ï¼šå®ç°ä¿¡å·å¤„ç†æœºåˆ¶æ•è·æ®µé”™è¯¯

---

## å®éªŒç»“æœ

### ğŸ¯ æ ¸å¿ƒç»“è®º

> **A[12] ä¸ä¼šå´©æºƒï¼Œå¯ä»¥æ­£å¸¸è®¿é—®ï¼**
> 
> **Aæ•°ç»„å¯ä»¥ç›´æ¥æ”¹å†™Bæ•°ç»„çš„å†…å®¹ï¼**

### è¯¦ç»†æµ‹è¯•æ•°æ®

#### 1. å†…å­˜å¸ƒå±€åˆ†æ

```
=== æ•°ç»„ä¿¡æ¯ ===
æ•°ç»„Aåœ°å€: 0x564e0133f120
æ•°ç»„Båœ°å€: 0x564e0133f110  
æ•°ç»„Aå¤§å°: 10 å­—èŠ‚
æ•°ç»„Bå¤§å°: 10 å­—èŠ‚
Aå’ŒBä¹‹é—´çš„è·ç¦»: -16 å­—èŠ‚
```

**ç¬¦å·è¡¨ä¿¡æ¯**ï¼ˆé€šè¿‡objdumpè·å–ï¼‰ï¼š
```
0000000000004110 g     O .bss   000000000000000a              B
0000000000004120 g     O .bss   000000000000000a              A
```

#### 2. è¶Šç•Œè®¿é—®æµ‹è¯•ç»“æœ

| è®¿é—®ä½ç½® | è¯»å–ç»“æœ | å†™å…¥ç»“æœ | æ˜¯å¦å´©æºƒ |
|----------|----------|----------|----------|
| A[10] | âœ… æˆåŠŸ | âœ… æˆåŠŸ | âŒ æ— å´©æºƒ |
| A[11] | âœ… æˆåŠŸ | âœ… æˆåŠŸ | âŒ æ— å´©æºƒ |
| **A[12]** | **âœ… æˆåŠŸ** | **âœ… æˆåŠŸ** | **âŒ æ— å´©æºƒ** |
| A[13-15] | âœ… æˆåŠŸ | - | âŒ æ— å´©æºƒ |
| A[20-100] | âœ… æˆåŠŸ | - | âŒ æ— å´©æºƒ |

#### 4. **æ–°å¢ï¼šAæ•°ç»„æ”¹å†™Bæ•°ç»„æµ‹è¯•**

| æµ‹è¯•æ–¹æ³• | è®¿é—®æ–¹å¼ | ç»“æœ | è¯´æ˜ |
|----------|----------|------|------|
| **è´Ÿç´¢å¼•è®¿é—®** | A[-16] | âœ… **æˆåŠŸæ”¹å†™B[0]** | Båœ¨Aå‰16å­—èŠ‚ |
| **ç³»ç»Ÿæ€§æµ‹è¯•** | A[-16] ~ A[-7] | âœ… **å®Œå…¨æ§åˆ¶Bæ•°ç»„** | å¯æ”¹å†™B[0] ~ B[9] |
| **AddressSanitizer** | A[-20] | âŒ **æ£€æµ‹åˆ°æº¢å‡º** | å…¨å±€ç¼“å†²åŒºæº¢å‡ºé”™è¯¯ |

#### 5. å†…å­˜å¸ƒå±€è¯¦ç»†åˆ†æ

**å®é™…å†…å­˜å¸ƒå±€**ï¼š
```
å†…å­˜åœ°å€ä»ä½åˆ°é«˜ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°ç»„B     â”‚   å¡«å……åŒºåŸŸ   â”‚   æ•°ç»„A     â”‚
â”‚ (10å­—èŠ‚)    â”‚  (6å­—èŠ‚)    â”‚ (10å­—èŠ‚)    â”‚
â”‚0x...1110   â”‚             â”‚0x...1120   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â†‘                           â†‘
   A[-16]~A[-7]              A[0]~A[9]
   å¯ä»¥æ”¹å†™B[0]~B[9]         æ­£å¸¸Aæ•°ç»„èŒƒå›´
```

**å…³é”®å‘ç°**ï¼š
- Bæ•°ç»„åœ¨Aæ•°ç»„å‰é¢16å­—èŠ‚
- A[-16] å¯¹åº” B[0]ï¼ŒA[-15] å¯¹åº” B[1]ï¼Œä»¥æ­¤ç±»æ¨
- A[-16] ~ A[-7] å¯ä»¥å®Œå…¨æ§åˆ¶Bæ•°ç»„çš„æ‰€æœ‰10ä¸ªå…ƒç´ 

#### 6. åŸå§‹å†…å­˜å†…å®¹åˆ†æ

```
ä»A[0]å¼€å§‹çš„20ä¸ªå­—èŠ‚å†…å®¹:
åç§» 0: åœ°å€0x564e0133f120, å€¼=A (ASCII: 65)
åç§» 1: åœ°å€0x564e0133f121, å€¼=B (ASCII: 66)
...
åç§» 9: åœ°å€0x564e0133f129, å€¼=J (ASCII: 74)
åç§»10: åœ°å€0x564e0133f12a, å€¼=X (ASCII: 88)  â† A[10]å†™å…¥æˆåŠŸ
åç§»11: åœ°å€0x564e0133f12b, å€¼=X (ASCII: 88)  â† A[11]å†™å…¥æˆåŠŸ
åç§»12: åœ°å€0x564e0133f12c, å€¼=X (ASCII: 88)  â† A[12]å†™å…¥æˆåŠŸ
åç§»13: åœ°å€0x564e0133f12d, å€¼=? (ASCII:  0)
...
```

---

## æ·±å…¥åˆ†æ

### ğŸ” ä¸ºä»€ä¹ˆA[12]ä¸ä¼šå´©æºƒï¼Ÿä¸ºä»€ä¹ˆAå¯ä»¥æ”¹å†™Bï¼Ÿ

#### 1. å†…å­˜æ®µç‰¹æ€§

**å…¨å±€æ•°ç»„ä½äº.bssæ®µ**
- `.bssæ®µ`ï¼šå­˜å‚¨æœªåˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€å˜é‡
- **è¿ç»­å†…å­˜**ï¼šåŒä¸€æ®µå†…çš„å˜é‡é€šå¸¸åˆ†é…åœ¨è¿ç»­å†…å­˜ä¸­
- **é›¶åˆå§‹åŒ–**ï¼š.bssæ®µåœ¨ç¨‹åºå¯åŠ¨æ—¶è¢«é›¶åˆå§‹åŒ–

#### 2. å†…å­˜å¯¹é½æœºåˆ¶

```
å†…å­˜å¸ƒå±€ç¤ºæ„å›¾ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ•°ç»„B     â”‚   å¡«å……åŒºåŸŸ   â”‚   æ•°ç»„A     â”‚
â”‚ (10å­—èŠ‚)    â”‚  (6å­—èŠ‚)    â”‚ (10å­—èŠ‚)    â”‚
â”‚0x...4110   â”‚             â”‚0x...4120   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†‘
         A[10], A[11], A[12]
         è®¿é—®è¿™ä¸ªåŒºåŸŸ
```

**ç¼–è¯‘å™¨å¯¹é½ç­–ç•¥**ï¼š
- ä¸ºäº†æ€§èƒ½ä¼˜åŒ–ï¼Œç¼–è¯‘å™¨ä¼šè¿›è¡Œå†…å­˜å¯¹é½
- åœ¨æ•°ç»„ä¹‹é—´å¯èƒ½æ’å…¥å¡«å……å­—èŠ‚
- è¿™äº›å¡«å……åŒºåŸŸé€šå¸¸å¯ä»¥å®‰å…¨è®¿é—®

#### 3. æ“ä½œç³»ç»Ÿä¿æŠ¤æœºåˆ¶

**é¡µçº§å†…å­˜ä¿æŠ¤**ï¼š
- Linuxå†…å­˜ä¿æŠ¤ä»¥é¡µä¸ºå•ä½ï¼ˆé€šå¸¸4KBï¼‰
- å°èŒƒå›´è¶Šç•Œï¼ˆå‡ ä¸ªå­—èŠ‚ï¼‰ä¸ä¼šè·¨è¶Šé¡µè¾¹ç•Œ
- åªè¦åœ¨åŒä¸€é¡µå†…ï¼Œä¸ä¼šè§¦å‘æ®µé”™è¯¯

**è™šæ‹Ÿå†…å­˜ç®¡ç†**ï¼š
- å…¨å±€å˜é‡åœ¨è¿›ç¨‹å¯åŠ¨æ—¶å°±åˆ†é…å¥½å†…å­˜
- .bssæ®µé€šå¸¸æœ‰è¾ƒå¤§çš„è¿ç»­ç©ºé—´
- è¶Šç•Œè®¿é—®ä»åœ¨è¿›ç¨‹çš„åˆæ³•åœ°å€ç©ºé—´å†…

### ğŸ§ª ä¸åŒç¼–è¯‘é€‰é¡¹çš„å½±å“

#### AddressSanitizeræµ‹è¯•

**è¶Šç•Œè®¿é—®æµ‹è¯•**ï¼š
```bash
gcc -fsanitize=address -o test test.c
./test
# ç»“æœï¼šA[12]è®¿é—®ä»ç„¶æ²¡æœ‰æ£€æµ‹åˆ°é”™è¯¯
```

**æ”¹å†™Bæ•°ç»„æµ‹è¯•**ï¼š
```bash
# å½“æµ‹è¯•A[-20]æ—¶ï¼ŒAddressSanitizeræ£€æµ‹åˆ°é”™è¯¯ï¼š
ERROR: AddressSanitizer: global-buffer-overflow
WRITE of size 1 at 0x5574cb8f61dc thread T0
SUMMARY: AddressSanitizer: global-buffer-overflow
```

**åŸå› åˆ†æ**ï¼š
- AddressSanitizerå¯¹å…¨å±€æ•°ç»„çš„å°èŒƒå›´è¶Šç•Œæ£€æµ‹ä¸å¤Ÿæ•æ„Ÿ
- ä½†å¯¹äºè¾ƒå¤§èŒƒå›´çš„è¶Šç•Œè®¿é—®ï¼ˆå¦‚A[-20]ï¼‰èƒ½å¤Ÿæ£€æµ‹åˆ°
- A[-16] ~ A[-7]çš„è®¿é—®æ²¡æœ‰è¢«æ£€æµ‹åˆ°ï¼Œè¯´æ˜åœ¨"å®‰å…¨"èŒƒå›´å†…

#### ä¸åŒä¼˜åŒ–çº§åˆ«
- **-O0**ï¼šæ— ä¼˜åŒ–ï¼Œè¶Šç•Œè®¿é—®æˆåŠŸ
- **-O2/-O3**ï¼šå¯èƒ½æ”¹å˜å†…å­˜å¸ƒå±€ï¼Œä½†é€šå¸¸ä»å¯è®¿é—®

---

## å®‰å…¨æ€§è®¨è®º

### âš ï¸ é£é™©è¯„ä¼°

#### 1. æ•°æ®ç ´åé£é™©
```c
// å±é™©ç¤ºä¾‹
A[12] = 'X';  // å¯èƒ½è¦†ç›–å…¶ä»–é‡è¦æ•°æ®
```

#### 2. ç¼“å†²åŒºæº¢å‡ºæ”»å‡»
- è™½ç„¶ä¸ä¼šç«‹å³å´©æºƒï¼Œä½†å¯èƒ½è¢«æ¶æ„åˆ©ç”¨
- æ”»å‡»è€…å¯èƒ½é€šè¿‡è¶Šç•Œå†™å…¥æ³¨å…¥æ¶æ„ä»£ç 
- **ç‰¹åˆ«å±é™©**ï¼šAæ•°ç»„å¯ä»¥å®Œå…¨æ§åˆ¶Bæ•°ç»„ï¼Œå¦‚æœBæ•°ç»„å­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ã€æƒé™æ ‡å¿—ï¼‰ï¼Œåæœä¸¥é‡

#### 3. è°ƒè¯•å›°éš¾
- è¶Šç•Œè®¿é—®å¯èƒ½å¯¼è‡´éš¾ä»¥é‡ç°çš„bug
- æ•°æ®æŸåå¯èƒ½åœ¨å¾ˆä¹…ä¹‹åæ‰è¡¨ç°å‡ºæ¥

### ğŸ›¡ï¸ æœªå®šä¹‰è¡Œä¸ºçš„å±é™©æ€§

**Cæ ‡å‡†è§‚ç‚¹**ï¼š
> æ•°ç»„è¶Šç•Œè®¿é—®æ˜¯æœªå®šä¹‰è¡Œä¸ºï¼ˆUndefined Behaviorï¼‰ï¼Œç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ç¯å¢ƒä¸ä¿è¯ä»»ä½•ç‰¹å®šçš„è¡Œä¸ºã€‚

**å®é™…å½±å“**ï¼š
1. **ç¼–è¯‘å™¨å·®å¼‚**ï¼šä¸åŒç¼–è¯‘å™¨å¯èƒ½æœ‰ä¸åŒçš„å†…å­˜å¸ƒå±€
2. **å¹³å°å·®å¼‚**ï¼šä¸åŒæ“ä½œç³»ç»Ÿã€æ¶æ„å¯èƒ½è¡¨ç°ä¸åŒ
3. **ç‰ˆæœ¬å·®å¼‚**ï¼šåŒä¸€ç¼–è¯‘å™¨çš„ä¸åŒç‰ˆæœ¬å¯èƒ½æ”¹å˜è¡Œä¸º
4. **ä¼˜åŒ–å½±å“**ï¼šç¼–è¯‘å™¨ä¼˜åŒ–å¯èƒ½æ”¹å˜å†…å­˜å¸ƒå±€

---

## æœ€ä½³å®è·µå»ºè®®

### âœ… å®‰å…¨ç¼–ç¨‹å®è·µ

#### 1. è¾¹ç•Œæ£€æŸ¥
```c
// æ¨èåšæ³•
void safe_array_access(char* arr, int size, int index, char value) {
    if (index >= 0 && index < size) {
        arr[index] = value;
    } else {
        fprintf(stderr, "æ•°ç»„è¶Šç•Œï¼šç´¢å¼• %d è¶…å‡ºèŒƒå›´ [0, %d)\n", index, size);
    }
}
```

#### 2. ä½¿ç”¨å®‰å…¨çš„æ•°æ®ç»“æ„
```c
// ä½¿ç”¨ç»“æ„ä½“å°è£…æ•°ç»„
typedef struct {
    char data[10];
    int size;
} SafeArray;

int safe_set(SafeArray* arr, int index, char value) {
    if (index >= 0 && index < arr->size) {
        arr->data[index] = value;
        return 1;  // æˆåŠŸ
    }
    return 0;  // å¤±è´¥
}
```

#### 3. ç¼–è¯‘æ—¶æ£€æŸ¥
```bash
# å¯ç”¨æ‰€æœ‰è­¦å‘Š
gcc -Wall -Wextra -Werror -o program program.c

# ä½¿ç”¨é™æ€åˆ†æå·¥å…·
gcc -fanalyzer -o program program.c

# ä½¿ç”¨è¿è¡Œæ—¶æ£€æŸ¥
gcc -fsanitize=address -fsanitize=bounds -o program program.c
```

#### 4. ä»£ç å®¡æŸ¥æ¸…å•
- [ ] æ‰€æœ‰æ•°ç»„è®¿é—®éƒ½æœ‰è¾¹ç•Œæ£€æŸ¥
- [ ] ä½¿ç”¨`sizeof()`è€Œä¸æ˜¯ç¡¬ç¼–ç æ•°ç»„å¤§å°
- [ ] å¾ªç¯è¾¹ç•Œæ­£ç¡®è®¾ç½®
- [ ] æŒ‡é’ˆè¿ç®—æœ‰èŒƒå›´éªŒè¯

### ğŸ”§ å¼€å‘å·¥å…·æ¨è

| å·¥å…· | ç”¨é€” | å‘½ä»¤ç¤ºä¾‹ |
|------|------|----------|
| **AddressSanitizer** | å†…å­˜é”™è¯¯æ£€æµ‹ | `gcc -fsanitize=address` |
| **Valgrind** | å†…å­˜æ³„æ¼æ£€æµ‹ | `valgrind --tool=memcheck ./program` |
| **Clang Static Analyzer** | é™æ€ä»£ç åˆ†æ | `clang --analyze program.c` |
| **Cppcheck** | é™æ€åˆ†æ | `cppcheck program.c` |

---

## é™„å½•

### A. å®Œæ•´æµ‹è¯•ä»£ç 

#### 1. åŸºç¡€è¶Šç•Œè®¿é—®æµ‹è¯•ç¨‹åº (`array_bounds_test.c`)

è¿™æ˜¯æœ€åŸºç¡€çš„æµ‹è¯•ç¨‹åºï¼ŒéªŒè¯A[12]æ˜¯å¦å¯ä»¥è®¿é—®ï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <signal.h>
#include <setjmp.h>

// å®šä¹‰ä¸¤ä¸ªå…¨å±€å­—ç¬¦æ•°ç»„ï¼Œå¤§å°ä¸º10
char A[10];
char B[10];

// ç”¨äºæ•è·æ®µé”™è¯¯çš„è·³è½¬ç¼“å†²åŒº
static jmp_buf segfault_buf;
static int segfault_occurred = 0;

// æ®µé”™è¯¯ä¿¡å·å¤„ç†å‡½æ•°
void segfault_handler(int sig) {
    segfault_occurred = 1;
    longjmp(segfault_buf, 1);
}

void print_array_info() {
    printf("=== æ•°ç»„ä¿¡æ¯ ===\n");
    printf("æ•°ç»„Aåœ°å€: %p\n", (void*)A);
    printf("æ•°ç»„Båœ°å€: %p\n", (void*)B);
    printf("æ•°ç»„Aå¤§å°: %zu å­—èŠ‚\n", sizeof(A));
    printf("æ•°ç»„Bå¤§å°: %zu å­—èŠ‚\n", sizeof(B));
    printf("Aå’ŒBä¹‹é—´çš„è·ç¦»: %ld å­—èŠ‚\n", (char*)B - (char*)A);
    printf("\n");
}

void initialize_arrays() {
    // åˆå§‹åŒ–æ•°ç»„A
    for (int i = 0; i < 10; i++) {
        A[i] = 'A' + i;  // A[0]='A', A[1]='B', ..., A[9]='J'
    }
    
    // åˆå§‹åŒ–æ•°ç»„B
    for (int i = 0; i < 10; i++) {
        B[i] = 'a' + i;  // B[0]='a', B[1]='b', ..., B[9]='j'
    }
    
    printf("=== æ•°ç»„åˆå§‹åŒ–å®Œæˆ ===\n");
    printf("æ•°ç»„Aå†…å®¹: ");
    for (int i = 0; i < 10; i++) {
        printf("%c ", A[i]);
    }
    printf("\n");
    
    printf("æ•°ç»„Bå†…å®¹: ");
    for (int i = 0; i < 10; i++) {
        printf("%c ", B[i]);
    }
    printf("\n\n");
}

void test_array_access() {
    printf("=== æµ‹è¯•æ•°ç»„è®¿é—® ===\n");
    
    // æµ‹è¯•æ­£å¸¸è®¿é—®
    printf("æ­£å¸¸è®¿é—®æµ‹è¯•:\n");
    printf("A[0] = %c\n", A[0]);
    printf("A[9] = %c\n", A[9]);
    printf("B[0] = %c\n", B[0]);
    printf("B[9] = %c\n", B[9]);
    printf("\n");
    
    // æµ‹è¯•è¶Šç•Œè®¿é—®
    printf("è¶Šç•Œè®¿é—®æµ‹è¯•:\n");
    
    // è®¾ç½®ä¿¡å·å¤„ç†å™¨
    signal(SIGSEGV, segfault_handler);
    
    // æµ‹è¯•è®¿é—®A[10], A[11], A[12]ç­‰
    for (int i = 10; i <= 15; i++) {
        segfault_occurred = 0;
        
        if (setjmp(segfault_buf) == 0) {
            // å°è¯•è¯»å–
            char value = A[i];
            printf("A[%d] = %c (ASCII: %d) - æˆåŠŸè¯»å–\n", i, 
                   (value >= 32 && value <= 126) ? value : '?', (int)value);
        } else {
            printf("A[%d] - è®¿é—®æ—¶å‘ç”Ÿæ®µé”™è¯¯ï¼\n", i);
        }
    }
    
    printf("\n");
    
    // æµ‹è¯•å†™å…¥è¶Šç•Œä½ç½®
    printf("è¶Šç•Œå†™å…¥æµ‹è¯•:\n");
    for (int i = 10; i <= 12; i++) {
        segfault_occurred = 0;
        
        if (setjmp(segfault_buf) == 0) {
            A[i] = 'X';
            printf("A[%d] = 'X' - æˆåŠŸå†™å…¥\n", i);
        } else {
            printf("A[%d] - å†™å…¥æ—¶å‘ç”Ÿæ®µé”™è¯¯ï¼\n", i);
        }
    }
    
    printf("\n");
    
    // æ£€æŸ¥Bæ•°ç»„æ˜¯å¦è¢«å½±å“
    printf("æ£€æŸ¥Bæ•°ç»„æ˜¯å¦è¢«å½±å“:\n");
    printf("æ•°ç»„Bå½“å‰å†…å®¹: ");
    for (int i = 0; i < 10; i++) {
        printf("%c ", B[i]);
    }
    printf("\n");
}

void test_memory_layout() {
    printf("=== å†…å­˜å¸ƒå±€åˆ†æ ===\n");
    
    // æ˜¾ç¤ºå†…å­˜ä¸­çš„å®é™…å†…å®¹
    printf("ä»A[0]å¼€å§‹çš„20ä¸ªå­—èŠ‚å†…å®¹:\n");
    for (int i = 0; i < 20; i++) {
        char* ptr = (char*)A + i;
        printf("åç§»%2d: åœ°å€%p, å€¼=%c (ASCII:%3d)\n", 
               i, (void*)ptr, 
               (*ptr >= 32 && *ptr <= 126) ? *ptr : '?', 
               (int)*ptr);
    }
    printf("\n");
    
    // æ£€æŸ¥Aå’ŒBçš„ç›¸å¯¹ä½ç½®
    if ((char*)B > (char*)A) {
        long distance = (char*)B - (char*)A;
        printf("Bæ•°ç»„åœ¨Aæ•°ç»„ä¹‹å %ld å­—èŠ‚\n", distance);
        if (distance == 10) {
            printf("Aå’ŒBåœ¨å†…å­˜ä¸­æ˜¯è¿ç»­çš„ï¼A[10]å®é™…ä¸Šå°±æ˜¯B[0]\n");
        } else if (distance < 20) {
            printf("Aå’ŒBåœ¨å†…å­˜ä¸­å¾ˆæ¥è¿‘ï¼Œå¯èƒ½å­˜åœ¨é‡å è®¿é—®\n");
        }
    } else {
        long distance = (char*)A - (char*)B;
        printf("Aæ•°ç»„åœ¨Bæ•°ç»„ä¹‹å %ld å­—èŠ‚\n", distance);
    }
}

int main() {
    printf("å…¨å±€å­—ç¬¦æ•°ç»„è¶Šç•Œè®¿é—®æµ‹è¯•ç¨‹åº\n");
    printf("=====================================\n\n");
    
    print_array_info();
    initialize_arrays();
    test_array_access();
    test_memory_layout();
    
    printf("=== æµ‹è¯•æ€»ç»“ ===\n");
    printf("1. å…¨å±€æ•°ç»„é€šå¸¸åˆ†é…åœ¨æ•°æ®æ®µ(.dataæˆ–.bss)\n");
    printf("2. ç¼–è¯‘å™¨å¯èƒ½ä¼šå°†ç›¸é‚»å£°æ˜çš„å…¨å±€æ•°ç»„æ”¾åœ¨è¿ç»­å†…å­˜ä¸­\n");
    printf("3. è¶Šç•Œè®¿é—®å¯èƒ½ä¸ä¼šç«‹å³å´©æºƒï¼Œä½†ä¼šå¯¼è‡´æœªå®šä¹‰è¡Œä¸º\n");
    printf("4. å®é™…è¡Œä¸ºå–å†³äºç¼–è¯‘å™¨ã€é“¾æ¥å™¨å’Œè¿è¡Œæ—¶ç¯å¢ƒ\n");
    printf("5. åœ¨ç”Ÿäº§ä»£ç ä¸­åº”è¯¥é¿å…ä»»ä½•å½¢å¼çš„è¶Šç•Œè®¿é—®\n");
    
    return 0;
}
```

#### 2. æ•°ç»„æ”¹å†™æµ‹è¯•ç¨‹åº (`array_overwrite_test.c`)

è¿™ä¸ªç¨‹åºä¸“é—¨æµ‹è¯•Aæ•°ç»„æ˜¯å¦å¯ä»¥æ”¹å†™Bæ•°ç»„çš„å†…å®¹ï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <signal.h>
#include <setjmp.h>

// å®šä¹‰ä¸¤ä¸ªå…¨å±€å­—ç¬¦æ•°ç»„ï¼Œå¤§å°ä¸º10
char A[10];
char B[10];

// ç”¨äºæ•è·æ®µé”™è¯¯çš„è·³è½¬ç¼“å†²åŒº
static jmp_buf segfault_buf;
static int segfault_occurred = 0;

// æ®µé”™è¯¯ä¿¡å·å¤„ç†å‡½æ•°
void segfault_handler(int sig) {
    segfault_occurred = 1;
    longjmp(segfault_buf, 1);
}

void print_memory_layout() {
    printf("=== å†…å­˜å¸ƒå±€ä¿¡æ¯ ===\n");
    printf("æ•°ç»„Aåœ°å€: %p\n", (void*)A);
    printf("æ•°ç»„Båœ°å€: %p\n", (void*)B);
    printf("Aå’ŒBä¹‹é—´çš„è·ç¦»: %ld å­—èŠ‚\n", (char*)B - (char*)A);
    
    // åˆ¤æ–­Aå’ŒBçš„ç›¸å¯¹ä½ç½®
    if ((char*)A < (char*)B) {
        printf("å†…å­˜å¸ƒå±€: Aåœ¨å‰ï¼ŒBåœ¨å\n");
        printf("A[10]åŠä»¥åå¯èƒ½å½±å“Bæ•°ç»„\n");
    } else {
        printf("å†…å­˜å¸ƒå±€: Båœ¨å‰ï¼ŒAåœ¨å\n");
        printf("Açš„è´Ÿç´¢å¼•å¯èƒ½å½±å“Bæ•°ç»„\n");
    }
    printf("\n");
}

void initialize_arrays() {
    printf("=== åˆå§‹åŒ–æ•°ç»„ ===\n");
    
    // åˆå§‹åŒ–æ•°ç»„A
    for (int i = 0; i < 10; i++) {
        A[i] = 'A' + i;  // A[0]='A', A[1]='B', ..., A[9]='J'
    }
    
    // åˆå§‹åŒ–æ•°ç»„B
    for (int i = 0; i < 10; i++) {
        B[i] = 'a' + i;  // B[0]='a', B[1]='b', ..., B[9]='j'
    }
    
    printf("æ•°ç»„Aåˆå§‹å†…å®¹: ");
    for (int i = 0; i < 10; i++) {
        printf("%c ", A[i]);
    }
    printf("\n");
    
    printf("æ•°ç»„Båˆå§‹å†…å®¹: ");
    for (int i = 0; i < 10; i++) {
        printf("%c ", B[i]);
    }
    printf("\n\n");
}

int test_overwrite_via_negative_index() {
    printf("=== æµ‹è¯•é€šè¿‡è´Ÿç´¢å¼•æ”¹å†™Bæ•°ç»„ ===\n");
    
    long distance = (char*)A - (char*)B;
    int b_changed = 0;
    
    if (distance > 0) {
        // Aåœ¨Båé¢ï¼Œå°è¯•é€šè¿‡Açš„è´Ÿç´¢å¼•è®¿é—®B
        printf("Aåœ¨Båé¢ï¼Œè·ç¦»%ldå­—èŠ‚ï¼Œå°è¯•é€šè¿‡A[-%ld]è®¿é—®B[0]\n", distance, distance);
        
        segfault_occurred = 0;
        if (setjmp(segfault_buf) == 0) {
            char old_b0 = B[0];
            A[-distance] = 'Y';  // å°è¯•é€šè¿‡Açš„è´Ÿç´¢å¼•ä¿®æ”¹B[0]
            
            if (B[0] != old_b0) {
                printf("âœ… æˆåŠŸï¼A[-%ld] = 'Y' æ”¹å˜äº†B[0]: '%c' -> '%c'\n", 
                       distance, old_b0, B[0]);
                b_changed = 1;
            } else {
                printf("âŒ A[-%ld] = 'Y' æ²¡æœ‰å½±å“B[0]\n", distance);
            }
        } else {
            printf("âŒ è®¿é—®A[-%ld]æ—¶å‘ç”Ÿæ®µé”™è¯¯\n", distance);
        }
    } else {
        printf("Båœ¨Aåé¢ï¼Œæ— æ³•é€šè¿‡è´Ÿç´¢å¼•ç›´æ¥è®¿é—®B\n");
    }
    
    return b_changed;
}

void test_systematic_overwrite() {
    printf("=== ç³»ç»Ÿæ€§æµ‹è¯•ï¼šå¯»æ‰¾èƒ½å½±å“Bçš„Aç´¢å¼• ===\n");
    
    // é‡æ–°åˆå§‹åŒ–æ•°ç»„
    initialize_arrays();
    
    printf("æµ‹è¯•èŒƒå›´ï¼šA[-20] åˆ° A[30]\n");
    
    for (int offset = -20; offset <= 30; offset++) {
        // ä¿å­˜Bæ•°ç»„çš„åŸå§‹çŠ¶æ€
        char original_b[10];
        memcpy(original_b, B, 10);
        
        segfault_occurred = 0;
        if (setjmp(segfault_buf) == 0) {
            // å°è¯•å†™å…¥ä¸€ä¸ªç‰¹æ®Šå€¼
            A[offset] = 'Z';
            
            // æ£€æŸ¥Bæ•°ç»„æ˜¯å¦è¢«æ”¹å˜
            int b_index_changed = -1;
            for (int i = 0; i < 10; i++) {
                if (B[i] != original_b[i]) {
                    b_index_changed = i;
                    break;
                }
            }
            
            if (b_index_changed >= 0) {
                printf("ğŸ¯ A[%d] = 'Z' å½±å“äº†B[%d]: '%c' -> '%c'\n", 
                       offset, b_index_changed, original_b[b_index_changed], B[b_index_changed]);
                
                // æ¢å¤Bæ•°ç»„
                B[b_index_changed] = original_b[b_index_changed];
            }
        } else {
            printf("ğŸ’¥ A[%d] è®¿é—®æ—¶å‘ç”Ÿæ®µé”™è¯¯\n", offset);
        }
    }
}

// ... å…¶ä»–å‡½æ•°çœç•¥ ...

int main() {
    printf("å…¨å±€æ•°ç»„Aæ”¹å†™æ•°ç»„Bæµ‹è¯•ç¨‹åº\n");
    printf("================================\n\n");
    
    print_memory_layout();
    initialize_arrays();
    
    int negative_success = test_overwrite_via_negative_index();
    test_systematic_overwrite();
    
    printf("=== æµ‹è¯•æ€»ç»“ ===\n");
    printf("1. é€šè¿‡è´Ÿç´¢å¼•æ”¹å†™B: %s\n", negative_success ? "æˆåŠŸ" : "å¤±è´¥");
    printf("2. Aæ•°ç»„%sç›´æ¥æ”¹å†™Bæ•°ç»„çš„å†…å®¹\n", 
           negative_success ? "å¯ä»¥" : "æ— æ³•");
    printf("3. è¿™ç§è¡Œä¸ºæ˜¯æœªå®šä¹‰çš„ï¼Œä¸åº”åœ¨ç”Ÿäº§ä»£ç ä¸­ä½¿ç”¨\n");
    
    return 0;
}
```

#### 3. å®‰å…¨å¨èƒæ¼”ç¤ºç¨‹åº (`dangerous_demo.c`)

è¿™ä¸ªç¨‹åºæ¼”ç¤ºäº†æ•°ç»„è¶Šç•Œè®¿é—®å¦‚ä½•è¢«æ¶æ„åˆ©ç”¨ï¼š

```c
#include <stdio.h>
#include <string.h>

// æ¨¡æ‹Ÿä¸€ä¸ªçœŸå®çš„å®‰å…¨åœºæ™¯
char user_input[10];        // ç”¨æˆ·è¾“å…¥ç¼“å†²åŒº
char admin_flag[10];        // ç®¡ç†å‘˜æƒé™æ ‡å¿—

void initialize_system() {
    // åˆå§‹åŒ–ç®¡ç†å‘˜æ ‡å¿—ä¸º"NOADMIN"
    strcpy(admin_flag, "NOADMIN");
    printf("ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ\n");
    printf("ç®¡ç†å‘˜æƒé™: %s\n", admin_flag);
}

void process_user_input(const char* input) {
    printf("\nå¤„ç†ç”¨æˆ·è¾“å…¥: %s\n", input);
    
    // å±é™©çš„æ“ä½œï¼šæ²¡æœ‰è¾¹ç•Œæ£€æŸ¥çš„å¤åˆ¶
    for (int i = 0; input[i] != '\0'; i++) {
        user_input[i] = input[i];  // æ½œåœ¨çš„ç¼“å†²åŒºæº¢å‡º
    }
    
    printf("ç”¨æˆ·è¾“å…¥å·²ä¿å­˜\n");
}

void check_admin_privileges() {
    printf("\næ£€æŸ¥ç®¡ç†å‘˜æƒé™...\n");
    printf("å½“å‰ç®¡ç†å‘˜æ ‡å¿—: %s\n", admin_flag);
    
    if (strncmp(admin_flag, "ADMIN", 5) == 0) {
        printf("ğŸ”“ ç®¡ç†å‘˜æƒé™å·²æ¿€æ´»ï¼å¯ä»¥æ‰§è¡Œç‰¹æƒæ“ä½œã€‚\n");
    } else {
        printf("ğŸ”’ æ™®é€šç”¨æˆ·æƒé™ï¼Œæ— æ³•æ‰§è¡Œç‰¹æƒæ“ä½œã€‚\n");
    }
}

int main() {
    printf("å±é™©çš„æ•°ç»„è¶Šç•Œè®¿é—®æ¼”ç¤º\n");
    printf("========================\n");
    
    initialize_system();
    
    // æ­£å¸¸çš„ç”¨æˆ·è¾“å…¥
    printf("\n--- æµ‹è¯•1: æ­£å¸¸è¾“å…¥ ---\n");
    process_user_input("hello");
    check_admin_privileges();
    
    // å±é™©çš„é•¿è¾“å…¥ï¼Œå¯èƒ½è¦†ç›–admin_flag
    printf("\n--- æµ‹è¯•2: é•¿è¾“å…¥ï¼ˆå¯èƒ½çš„æ”»å‡»ï¼‰---\n");
    
    // è®¡ç®—éœ€è¦å¤šå°‘å­—ç¬¦æ‰èƒ½åˆ°è¾¾admin_flag
    long distance = (char*)admin_flag - (char*)user_input;
    
    if (distance > 0 && distance < 50) {
        printf("å°è¯•é€šè¿‡é•¿è¾“å…¥è¦†ç›–admin_flag...\n");
        
        // æ„é€ æ¶æ„è¾“å…¥
        char malicious_input[100];
        memset(malicious_input, 'X', distance);  // å¡«å……åˆ°admin_flagä½ç½®
        strcpy(malicious_input + distance, "ADMIN");  // åœ¨admin_flagä½ç½®å†™å…¥"ADMIN"
        malicious_input[distance + 5] = '\0';  // ç¡®ä¿å­—ç¬¦ä¸²ç»“æŸ
        
        printf("æ¶æ„è¾“å…¥é•¿åº¦: %ld å­—èŠ‚\n", strlen(malicious_input));
        process_user_input(malicious_input);
        check_admin_privileges();
        
        printf("\nğŸ’€ æ”»å‡»æˆåŠŸï¼é€šè¿‡ç¼“å†²åŒºæº¢å‡ºè·å¾—äº†ç®¡ç†å‘˜æƒé™ï¼\n");
    } else {
        printf("å½“å‰å†…å­˜å¸ƒå±€ä¸é€‚åˆæ¼”ç¤ºæ”»å‡»ï¼ˆè·ç¦»ï¼š%ldï¼‰\n", distance);
    }
    
    printf("\nâš ï¸  è¿™ä¸ªæ¼”ç¤ºå±•ç¤ºäº†ä¸ºä»€ä¹ˆæ•°ç»„è¶Šç•Œè®¿é—®å¦‚æ­¤å±é™©ï¼\n");
    printf("âš ï¸  åœ¨çœŸå®çš„ç¨‹åºä¸­ï¼Œè¿™ç§æ¼æ´å¯èƒ½è¢«æ¶æ„åˆ©ç”¨æ¥è·å–ç³»ç»Ÿæƒé™ã€‚\n");
    
    return 0;
}
```

#### 4. ç¼–è¯‘è„šæœ¬ (`Makefile`)

```makefile
CC = gcc
CFLAGS = -Wall -Wextra -g -O0
TARGET = array_bounds_test
SOURCE = array_bounds_test.c
OVERWRITE_TARGET = array_overwrite_test
OVERWRITE_SOURCE = array_overwrite_test.c
DEMO_TARGET = dangerous_demo
DEMO_SOURCE = dangerous_demo.c

# é»˜è®¤ç›®æ ‡
all: $(TARGET) $(OVERWRITE_TARGET) $(DEMO_TARGET)

# ç¼–è¯‘ç›®æ ‡
$(TARGET): $(SOURCE)
	$(CC) $(CFLAGS) -o $(TARGET) $(SOURCE)

# ç¼–è¯‘æ”¹å†™æµ‹è¯•ç¨‹åº
$(OVERWRITE_TARGET): $(OVERWRITE_SOURCE)
	$(CC) $(CFLAGS) -o $(OVERWRITE_TARGET) $(OVERWRITE_SOURCE)

# ç¼–è¯‘å±é™©æ¼”ç¤ºç¨‹åº
$(DEMO_TARGET): $(DEMO_SOURCE)
	$(CC) $(CFLAGS) -o $(DEMO_TARGET) $(DEMO_SOURCE)

# è¿è¡Œæµ‹è¯•
run: $(TARGET)
	./$(TARGET)

# è¿è¡Œæ”¹å†™æµ‹è¯•
run-overwrite: $(OVERWRITE_TARGET)
	./$(OVERWRITE_TARGET)

# è¿è¡Œå±é™©æ¼”ç¤º
run-demo: $(DEMO_TARGET)
	./$(DEMO_TARGET)

# ä½¿ç”¨AddressSanitizerç¼–è¯‘
asan: $(SOURCE)
	$(CC) $(CFLAGS) -fsanitize=address -o $(TARGET)_asan $(SOURCE)

# ä½¿ç”¨AddressSanitizerç¼–è¯‘æ”¹å†™æµ‹è¯•
asan-overwrite: $(OVERWRITE_SOURCE)
	$(CC) $(CFLAGS) -fsanitize=address -o $(OVERWRITE_TARGET)_asan $(OVERWRITE_SOURCE)

# è¿è¡ŒAddressSanitizerç‰ˆæœ¬
run-asan: asan
	./$(TARGET)_asan

# è¿è¡ŒAddressSanitizeræ”¹å†™æµ‹è¯•ç‰ˆæœ¬
run-asan-overwrite: asan-overwrite
	./$(OVERWRITE_TARGET)_asan

# æ¸…ç†
clean:
	rm -f $(TARGET) $(TARGET)_asan $(OVERWRITE_TARGET) $(OVERWRITE_TARGET)_asan $(DEMO_TARGET)

# æ˜¾ç¤ºå¸®åŠ©
help:
	@echo "å¯ç”¨çš„ç›®æ ‡:"
	@echo "  all                - ç¼–è¯‘æ‰€æœ‰ç¨‹åº"
	@echo "  run                - ç¼–è¯‘å¹¶è¿è¡Œè¶Šç•Œè®¿é—®æµ‹è¯•ç¨‹åº"
	@echo "  run-overwrite      - ç¼–è¯‘å¹¶è¿è¡Œæ•°ç»„æ”¹å†™æµ‹è¯•ç¨‹åº"
	@echo "  run-demo           - ç¼–è¯‘å¹¶è¿è¡Œå±é™©æ¼”ç¤ºç¨‹åº"
	@echo "  valgrind           - ä½¿ç”¨valgrindè¿è¡Œè¶Šç•Œè®¿é—®æµ‹è¯•"
	@echo "  asan               - ä½¿ç”¨AddressSanitizerç¼–è¯‘è¶Šç•Œè®¿é—®æµ‹è¯•"
	@echo "  asan-overwrite     - ä½¿ç”¨AddressSanitizerç¼–è¯‘æ”¹å†™æµ‹è¯•"
	@echo "  run-asan           - è¿è¡ŒAddressSanitizerç‰ˆæœ¬çš„è¶Šç•Œè®¿é—®æµ‹è¯•"
	@echo "  run-asan-overwrite - è¿è¡ŒAddressSanitizerç‰ˆæœ¬çš„æ”¹å†™æµ‹è¯•"
	@echo "  clean              - æ¸…ç†ç”Ÿæˆçš„æ–‡ä»¶"
	@echo "  help               - æ˜¾ç¤ºæ­¤å¸®åŠ©ä¿¡æ¯"

.PHONY: all run run-overwrite run-demo valgrind asan asan-overwrite run-asan run-asan-overwrite clean help
```

#### 5. ä»£ç ä½¿ç”¨è¯´æ˜

**å¿«é€Ÿå¼€å§‹**ï¼š
```bash
# 1. ä¸‹è½½æ‰€æœ‰ä»£ç æ–‡ä»¶åˆ°åŒä¸€ç›®å½•
# 2. ç¡®ä¿ç³»ç»Ÿå®‰è£…äº†GCCç¼–è¯‘å™¨
# 3. è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

# ç¼–è¯‘æ‰€æœ‰ç¨‹åº
make all

# è¿è¡ŒåŸºç¡€æµ‹è¯•ï¼ˆéªŒè¯A[12]è®¿é—®ï¼‰
make run

# è¿è¡Œæ”¹å†™æµ‹è¯•ï¼ˆéªŒè¯Aæ”¹å†™Bï¼‰
make run-overwrite

# è¿è¡Œå®‰å…¨æ¼”ç¤ºï¼ˆæƒé™æå‡æ”»å‡»ï¼‰
make run-demo
```

**é«˜çº§æµ‹è¯•**ï¼š
```bash
# ä½¿ç”¨AddressSanitizeræ£€æµ‹å†…å­˜é”™è¯¯
make run-asan-overwrite

# ä½¿ç”¨Valgrindæ£€æµ‹å†…å­˜é—®é¢˜
make valgrind

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help

# æ¸…ç†ç”Ÿæˆçš„æ–‡ä»¶
make clean
```

**ä»£ç ç»“æ„è¯´æ˜**ï¼š
- æ¯ä¸ªç¨‹åºéƒ½åŒ…å«æ®µé”™è¯¯å¤„ç†æœºåˆ¶
- ä½¿ç”¨`setjmp/longjmp`æ•è·å¯èƒ½çš„å´©æºƒ
- è¯¦ç»†çš„å†…å­˜å¸ƒå±€åˆ†æå’Œç»“æœè¾“å‡º
- æ”¯æŒå¤šç§ç¼–è¯‘å™¨é€‰é¡¹å’Œè°ƒè¯•å·¥å…·

### B. ç¼–è¯‘å’Œè¿è¡ŒæŒ‡ä»¤

```bash
# è¶Šç•Œè®¿é—®æµ‹è¯•
make run

# æ•°ç»„æ”¹å†™æµ‹è¯•
make run-overwrite

# AddressSanitizeræµ‹è¯•
make run-asan
make run-asan-overwrite

# Valgrindæµ‹è¯•
make valgrind

# æŸ¥çœ‹ç¬¦å·è¡¨
objdump -t array_bounds_test | grep -E "(A|B)$"

# æŸ¥çœ‹æ‰€æœ‰å¯ç”¨å‘½ä»¤
make help
```

### C. æµ‹è¯•ç»“æœç¤ºä¾‹

#### åŸºç¡€è¶Šç•Œè®¿é—®æµ‹è¯•è¾“å‡ºç¤ºä¾‹ï¼š
```
å…¨å±€å­—ç¬¦æ•°ç»„è¶Šç•Œè®¿é—®æµ‹è¯•ç¨‹åº
=====================================

=== æ•°ç»„ä¿¡æ¯ ===
æ•°ç»„Aåœ°å€: 0x564e0133f120
æ•°ç»„Båœ°å€: 0x564e0133f110
æ•°ç»„Aå¤§å°: 10 å­—èŠ‚
æ•°ç»„Bå¤§å°: 10 å­—èŠ‚
Aå’ŒBä¹‹é—´çš„è·ç¦»: -16 å­—èŠ‚

=== æ•°ç»„åˆå§‹åŒ–å®Œæˆ ===
æ•°ç»„Aå†…å®¹: A B C D E F G H I J 
æ•°ç»„Bå†…å®¹: a b c d e f g h i j 

=== æµ‹è¯•æ•°ç»„è®¿é—® ===
æ­£å¸¸è®¿é—®æµ‹è¯•:
A[0] = A
A[9] = J
B[0] = a
B[9] = j

è¶Šç•Œè®¿é—®æµ‹è¯•:
A[10] = ? (ASCII: 0) - æˆåŠŸè¯»å–
A[11] = ? (ASCII: 0) - æˆåŠŸè¯»å–
A[12] = ? (ASCII: 0) - æˆåŠŸè¯»å–  â† å…³é”®ç»“æœï¼šA[12]å¯ä»¥è®¿é—®ï¼
A[13] = ? (ASCII: 0) - æˆåŠŸè¯»å–
A[14] = ? (ASCII: 0) - æˆåŠŸè¯»å–
A[15] = ? (ASCII: 0) - æˆåŠŸè¯»å–

è¶Šç•Œå†™å…¥æµ‹è¯•:
A[10] = 'X' - æˆåŠŸå†™å…¥
A[11] = 'X' - æˆåŠŸå†™å…¥
A[12] = 'X' - æˆåŠŸå†™å…¥  â† å…³é”®ç»“æœï¼šA[12]å¯ä»¥å†™å…¥ï¼
```

#### æ•°ç»„æ”¹å†™æµ‹è¯•è¾“å‡ºç¤ºä¾‹ï¼š
```
å…¨å±€æ•°ç»„Aæ”¹å†™æ•°ç»„Bæµ‹è¯•ç¨‹åº
================================

=== å†…å­˜å¸ƒå±€ä¿¡æ¯ ===
æ•°ç»„Aåœ°å€: 0x564a46bc3120
æ•°ç»„Båœ°å€: 0x564a46bc3110
Aå’ŒBä¹‹é—´çš„è·ç¦»: -16 å­—èŠ‚
å†…å­˜å¸ƒå±€: Båœ¨å‰ï¼ŒAåœ¨å
Açš„è´Ÿç´¢å¼•å¯èƒ½å½±å“Bæ•°ç»„

=== æµ‹è¯•é€šè¿‡è´Ÿç´¢å¼•æ”¹å†™Bæ•°ç»„ ===
Aåœ¨Båé¢ï¼Œè·ç¦»16å­—èŠ‚ï¼Œå°è¯•é€šè¿‡A[-16]è®¿é—®B[0]
âœ… æˆåŠŸï¼A[-16] = 'Y' æ”¹å˜äº†B[0]: 'a' -> 'Y'  â† å…³é”®ç»“æœï¼šAå¯ä»¥æ”¹å†™Bï¼

=== ç³»ç»Ÿæ€§æµ‹è¯•ï¼šå¯»æ‰¾èƒ½å½±å“Bçš„Aç´¢å¼• ===
æµ‹è¯•èŒƒå›´ï¼šA[-20] åˆ° A[30]
ğŸ¯ A[-16] = 'Z' å½±å“äº†B[0]: 'a' -> 'Z'
ğŸ¯ A[-15] = 'Z' å½±å“äº†B[1]: 'b' -> 'Z'
ğŸ¯ A[-14] = 'Z' å½±å“äº†B[2]: 'c' -> 'Z'
ğŸ¯ A[-13] = 'Z' å½±å“äº†B[3]: 'd' -> 'Z'
ğŸ¯ A[-12] = 'Z' å½±å“äº†B[4]: 'e' -> 'Z'
ğŸ¯ A[-11] = 'Z' å½±å“äº†B[5]: 'f' -> 'Z'
ğŸ¯ A[-10] = 'Z' å½±å“äº†B[6]: 'g' -> 'Z'
ğŸ¯ A[-9] = 'Z' å½±å“äº†B[7]: 'h' -> 'Z'
ğŸ¯ A[-8] = 'Z' å½±å“äº†B[8]: 'i' -> 'Z'
ğŸ¯ A[-7] = 'Z' å½±å“äº†B[9]: 'j' -> 'Z'  â† A[-16]~A[-7]å®Œå…¨æ§åˆ¶Bæ•°ç»„ï¼
```

#### å®‰å…¨æ¼”ç¤ºè¾“å‡ºç¤ºä¾‹ï¼š
```
å±é™©çš„æ•°ç»„è¶Šç•Œè®¿é—®æ¼”ç¤º
========================
ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ
ç®¡ç†å‘˜æƒé™: NOADMIN

=== å†…å­˜å¸ƒå±€ä¿¡æ¯ ===
user_inputåœ°å€: 0x5561d97b2018
admin_flagåœ°å€: 0x5561d97b2028
ä¸¤è€…è·ç¦»: 16 å­—èŠ‚
âš ï¸  admin_flagåœ¨user_inputå16å­—èŠ‚
âš ï¸  user_input[16] å¯ä»¥ä¿®æ”¹admin_flag[0]

--- æµ‹è¯•1: æ­£å¸¸è¾“å…¥ ---
å¤„ç†ç”¨æˆ·è¾“å…¥: hello
ç”¨æˆ·è¾“å…¥å·²ä¿å­˜
æ£€æŸ¥ç®¡ç†å‘˜æƒé™...
å½“å‰ç®¡ç†å‘˜æ ‡å¿—: NOADMIN
ğŸ”’ æ™®é€šç”¨æˆ·æƒé™ï¼Œæ— æ³•æ‰§è¡Œç‰¹æƒæ“ä½œã€‚

--- æµ‹è¯•2: é•¿è¾“å…¥ï¼ˆå¯èƒ½çš„æ”»å‡»ï¼‰---
å°è¯•é€šè¿‡é•¿è¾“å…¥è¦†ç›–admin_flag...
æ¶æ„è¾“å…¥é•¿åº¦: 21 å­—èŠ‚
å¤„ç†ç”¨æˆ·è¾“å…¥: XXXXXXXXXXXXXXXXADMIN
ç”¨æˆ·è¾“å…¥å·²ä¿å­˜
æ£€æŸ¥ç®¡ç†å‘˜æƒé™...
å½“å‰ç®¡ç†å‘˜æ ‡å¿—: ADMININ
ğŸ”“ ç®¡ç†å‘˜æƒé™å·²æ¿€æ´»ï¼å¯ä»¥æ‰§è¡Œç‰¹æƒæ“ä½œã€‚  â† æ”»å‡»æˆåŠŸï¼

ğŸ’€ æ”»å‡»æˆåŠŸï¼é€šè¿‡ç¼“å†²åŒºæº¢å‡ºè·å¾—äº†ç®¡ç†å‘˜æƒé™ï¼
```

### D. ç›¸å…³èµ„æº

- [C11æ ‡å‡†æ–‡æ¡£](https://www.iso.org/standard/57853.html)
- [GCCæ–‡æ¡£ - AddressSanitizer](https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html)
- [Linuxå†…å­˜ç®¡ç†](https://www.kernel.org/doc/html/latest/admin-guide/mm/index.html)

---

## ğŸ“ ç»“è®º

é€šè¿‡è¯¦ç»†çš„å®éªŒéªŒè¯ï¼Œæˆ‘ä»¬å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š

### ğŸ¯ ç›´æ¥å›ç­”åŸé—®é¢˜ï¼š
1. **A[12]ä¸ä¼šå´©æºƒï¼Œå¯ä»¥æ­£å¸¸è®¿é—®**
2. **Aæ•°ç»„å¯ä»¥ç›´æ¥æ”¹å†™Bæ•°ç»„çš„å†…å®¹**

### ğŸ”¬ æŠ€æœ¯å‘ç°ï¼š
1. **å†…å­˜å¸ƒå±€**ï¼šBæ•°ç»„åœ¨Aæ•°ç»„å‰16å­—èŠ‚ï¼Œç¼–è¯‘å™¨åœ¨å®ƒä»¬ä¹‹é—´ç•™æœ‰6å­—èŠ‚å¡«å……
2. **è®¿é—®æ–¹å¼**ï¼šé€šè¿‡A[-16] ~ A[-7]å¯ä»¥å®Œå…¨æ§åˆ¶B[0] ~ B[9]
3. **æ£€æµ‹å·¥å…·**ï¼šAddressSanitizerèƒ½æ£€æµ‹åˆ°å¤§èŒƒå›´è¶Šç•Œï¼Œä½†å¯¹å°èŒƒå›´è¶Šç•Œä¸æ•æ„Ÿ

### âš ï¸ å®‰å…¨è­¦å‘Šï¼š
1. **æœªå®šä¹‰è¡Œä¸º**ï¼šè¿™ç§è®¿é—®æ–¹å¼æ˜¯Cæ ‡å‡†æœªå®šä¹‰çš„è¡Œä¸º
2. **æåº¦å±é™©**ï¼šAæ•°ç»„èƒ½å®Œå…¨æ§åˆ¶Bæ•°ç»„ï¼Œå¯èƒ½å¯¼è‡´ä¸¥é‡å®‰å…¨é—®é¢˜
3. **ä¸å¯ç§»æ¤**ï¼šä¸åŒç¼–è¯‘å™¨ã€å¹³å°å¯èƒ½æœ‰å®Œå…¨ä¸åŒçš„è¡Œä¸º

### ğŸ’¡ æœ€ä½³å®è·µï¼š
1. **æ°¸è¿œä¸è¦ä¾èµ–è¿™ç§è¡Œä¸º**
2. **ä½¿ç”¨è¾¹ç•Œæ£€æŸ¥å’Œå®‰å…¨çš„æ•°æ®ç»“æ„**
3. **å¯ç”¨æ‰€æœ‰ç¼–è¯‘å™¨è­¦å‘Šå’Œé™æ€åˆ†æå·¥å…·**

**æœ€é‡è¦çš„æé†’**ï¼šè™½ç„¶æµ‹è¯•æ˜¾ç¤ºä¸ä¼šå´©æºƒï¼Œä½†è¿™ç§è¡Œä¸ºæ˜¯ä¸å¯é¢„æµ‹å’Œä¸å¯ç§»æ¤çš„ã€‚åœ¨ä»»ä½•ç”Ÿäº§ç¯å¢ƒä¸­éƒ½åº”è¯¥é¿å…æ•°ç»„è¶Šç•Œè®¿é—®ã€‚

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š2025å¹´9æœˆ12æ—¥*  
*æµ‹è¯•ç¯å¢ƒï¼šLinux x86_64, GCCç¼–è¯‘å™¨*
